---
import Layout from "../layouts/Layout.astro";
---

<Layout title="ุชุญููู ุงูุตูุช ุฃู ุงูููุฏูู ุฅูู ูุต ๐ง">

<section class="max-w-3xl mx-auto px-4 py-12">

  <!-- TITLE -->
  <header class="text-center mb-10">
    <h1 class="text-3xl font-extrabold mb-3">
      ุชุญููู ุงูุตูุช ุฃู ุงูููุฏูู ุฅูู ูุต
    </h1>

    <p class="text-gray-500 text-lg">
      ุงุฑูุน ูููู ุงูุตูุชู ุฃู ุงูููุฏูู ูุณูุชู ุชุญูููู ุชููุงุฆูุงู
      ุฅูู ูุต ููุชูุจ ุฃู Subtitles ุจุฏูุฉ ุนุงููุฉ.
    </p>
  </header>

  <!-- โ ADSENSE (TOP โ SAFE) -->
  <div class="mb-10 border rounded-lg py-4 text-center text-gray-400 text-sm">
    ๐ ุฅุนูุงู (Google AdSense)
  </div>

  <!-- UPLOAD -->
  <div
    id="dropArea"
    class="border-2 border-dashed rounded-xl p-10 text-center cursor-pointer
           hover:border-purple-500 transition"
  >
    <p class="text-lg">
      ๐ ุงุณุญุจ ุงูููู ููุง ุฃู ุงุถุบุท ููุงุฎุชูุงุฑ
    </p>

    <p class="text-sm text-gray-500 mt-2">
      ูุฏุนู MP3 / WAV / MP4 / MKV
    </p>

    <input id="fileInput" type="file" accept="audio/*,video/*" hidden />
    <p id="fileName" class="mt-3 text-sm text-gray-600"></p>
  </div>

  <!-- ACTIONS -->
  <div class="flex gap-4 mt-6">
    <button
      id="btnText"
      class="flex-1 bg-purple-600 hover:bg-purple-700
             text-white py-3 rounded-xl font-semibold"
    >
      ๐ ุชุญููู ุฅูู ูุต
    </button>

  
  </div>

  <p id="status" class="mt-4 text-sm text-gray-600 text-center"></p>

  <!-- INFO (IMPORTANT FOR ADSENSE) -->
  <div class="mt-12 text-gray-600 text-sm leading-relaxed space-y-3">
    <p>
      โ ูุง ูุชู ุชุฎุฒูู ุงููููุงุช ุจุนุฏ ุงููุนุงูุฌุฉ.
    </p>
    <p>
      โ ุงููุชุงุฆุฌ ูุชู ุฅูุดุงุคูุง ุขููุงู ููุฏ ุชุญุชูู ุนูู ุฃุฎุทุงุก.
    </p>
    <p>
      โ ููุตุญ ุจูุฑุงุฌุนุฉ ุงููุต ูุจู ุงุณุชุนูุงูู ูุฃุบุฑุงุถ ุฑุณููุฉ.
    </p>
  </div>

  <!-- โ ADSENSE (BOTTOM โ OPTIONAL) -->
  <div class="mt-12 border rounded-lg py-4 text-center text-gray-400 text-sm">
    ๐ ุฅุนูุงู (Google AdSense)
  </div>

</section>

<script>
const dropArea = document.getElementById("dropArea");
const fileInput = document.getElementById("fileInput");
const fileName = document.getElementById("fileName");
const status = document.getElementById("status");

dropArea.onclick = () => fileInput.click();

fileInput.onchange = () => {
  if (fileInput.files[0]) {
    fileName.textContent = fileInput.files[0].name;
  }
};

async function transcribe(redirectTo) {
  const file = fileInput.files[0];
  if (!file) {
    status.textContent = "โ ุงุฎุชุฑ ูููุงู ุฃููุงู";
    return;
  }

  status.textContent = "โณ ุฌุงุฑู ุงูุชุญููู...";

  const formData = new FormData();
  formData.append("file", file);

  const res = await fetch("/api/transcribe", {
    method: "POST",
    body: formData
  });

  const data = await res.json();

  if (!res.ok) {
    status.textContent = data.error || "โ ุฎุทุฃ ุฃุซูุงุก ุงููุนุงูุฌุฉ";
    return;
  }

  // โ ุชุฎุฒูู ุงููุต ุงูุตุญูุญ
  localStorage.setItem("transcribed_text", data.text);

  window.location.href = redirectTo;
}

// โ ุฑุจุท ุงูุฒุฑ ุจุดูู ุขูู
const btnText = document.getElementById("btnText");
if (btnText) {
  btnText.onclick = () => transcribe("/result");
}
</script>


</Layout>
