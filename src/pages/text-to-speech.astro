---
import Layout from "../layouts/Layout.astro";
---

<Layout title="ุชุญููู ุงููุต ุฅูู ุตูุช">

<section class="min-h-screen bg-gray-50 flex items-center justify-center p-6">
  <div class="max-w-3xl w-full bg-white shadow-lg rounded-2xl p-8">

    <a href="/" class="text-purple-600 font-semibold mb-4 inline-block">
  โ ุงูุฑุฌูุน ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
</a>

    <h1 class="text-center text-2xl font-bold text-gray-900 mb-6">
      ๐ ุชุญููู ุงููุต ุฅูู ุตูุช ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
    </h1>

    <!-- Text Input -->
    <textarea id="ttsInput"
      class="w-full p-4 border rounded-xl text-gray-700 focus:ring-2 focus:ring-purple-500"
      rows="5"
      placeholder="ุฃุฏุฎู ุงููุต ุงูุฐู ุชุฑูุฏ ุชุญูููู ุฅูู ุตูุช..."
    ></textarea>

    <!-- Voice Options -->
    <label class="block mt-6 font-semibold">ุงุฎุชูุงุฑ ููุน ุงูุตูุช:</label>

<div class="mb-6">
  <label class="block mb-2 font-semibold text-gray-700">ุงุฎุชุฑ ุงูุตูุช:</label>
  
  <select id="voiceSelect" class="w-full p-3 border rounded-lg">
      <option value="alloy">Alloy (ูุญุงูุฏ)</option>
      <option value="verse">Verse (ุฅููุงุนู)</option>
      <option value="echo">Echo (ูุงุฏุฆ)</option>
      <option value="shimmer">Shimmer (ูุณุงุฆู)</option>
      
  </select>

  <button 
      onclick="previewVoice(document.getElementById('voiceSelect').value)"
      class="mt-3 px-4 py-2 bg-purple-600 text-white rounded">
      ๐ ูุนุงููุฉ ุงูุตูุช
  </button>
</div>



    <!-- Speed -->
    <label class="block mt-6 font-semibold">ุณุฑุนุฉ ุงูุตูุช:</label>
    <input id="speedInput" type="range" min="0.5" max="2" step="0.1"
      class="w-full"
    value="1" />
    <p class="text-gray-600 mt-1 text-sm">ุงูุณุฑุนุฉ: <span id="speedValue">1</span>x</p>

    <!-- Buttons -->
    <div class="mt-6 flex flex-col gap-3">
      <button id="copyBtn" class="bg-gray-200 w-full py-2 rounded-xl">
        ูุณุฎ ุงููุต
      </button>

      <button id="convertBtn"
        class="bg-purple-600 text-white w-full py-3 text-lg rounded-xl">
        ๐๏ธ ุชุญููู ุงููุต ุฅูู ุตูุช ุงูุขู
      </button>
    </div>

    <!-- Audio Player -->
    <audio id="audioPlayer" controls class="w-full mt-6 hidden"></audio>

    <!-- Download -->
    <button id="downloadBtn"
     class="bg-gray-200 w-full py-2 rounded-xl">
      โฌ ุชุญููู ุงูุตูุช MP3
    </button>

  </div>
</section>


<script>
document.getElementById("speedInput").addEventListener("input", (e) => {
  document.getElementById("speedValue").innerText = e.target.value;
});

document.getElementById("copyBtn").addEventListener("click", async () => {
  const text = document.getElementById("ttsInput").value.trim();

  if (!text) return alert("โ ูุง ููุฌุฏ ูุต ููุณุฎู!");

  await navigator.clipboard.writeText(text);
  alert("โ ุชู ูุณุฎ ุงููุต");
});

document.getElementById("convertBtn").addEventListener("click", async () => {
  const text = document.getElementById("ttsInput").value.trim();
  const voice = document.getElementById("voiceSelect").value;
  const speed = document.getElementById("speedInput").value;

  if (!text) return alert("โ ุงููุฑุฌู ุฅุฏุฎุงู ุงููุต ูุจู ุงูุชุญููู!");

  const res = await fetch("/api/tts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text, voice, speed }),
  });

  const audioBlob = await res.blob();
  const audioUrl = URL.createObjectURL(audioBlob);

  const player = document.getElementById("audioPlayer");
  player.src = audioUrl;
  player.classList.remove("hidden");

  const downloadBtn = document.getElementById("downloadBtn");
  downloadBtn.classList.remove("hidden");

  downloadBtn.onclick = () => {
    const a = document.createElement("a");
    a.href = audioUrl;
    a.download = "audio.mp3";
    a.click();
  };
});

window.previewVoice = async function (voice) {
  const phrase = "ูุฑุญุจุง! ูุฐุง ูุซุงู ุนูู ุตูุช " + voice;

  const res = await fetch("/api/tts-preview", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ voice, phrase })
  });

  const blob = await res.blob();
  const url = URL.createObjectURL(blob);

  const audio = new Audio(url);
  audio.play();

  document.getElementById("voiceSelect").value = voice;
}

 // Enable download
  downloadBtn.classList.remove("hidden");
  downloadBtn.onclick = () => {
    const a = document.createElement("a");
    a.href = url;
    a.download = "converted_audio.mp3";
    a.click();
  };

</script>

</Layout>
