---
import Layout from "../layouts/Layout.astro";
---

<Layout title="ุฅูุดุงุก ููุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู">

<section class="max-w-3xl mx-auto px-4 py-12">

  <!-- BACK -->
  <a href="/" class="inline-block mb-6 text-purple-600 hover:text-purple-800 font-semibold">
    โ ุงูุฑุฌูุน ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
  </a>

  <!-- TITLE -->
  <header class="text-center mb-8">
    <h1 class="text-3xl font-extrabold mb-3">
      โจ ุฅูุดุงุก ููุงู ุงุญุชุฑุงูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
    </h1>
    <p class="text-gray-600 text-lg">
      ุฃุฏุฎู ููุถูุน ุงูููุงู ูุณูููู ุจุฅูุดุงุก ููุงู ูุชูุงูู ุจุตูุงุบุฉ ุงุญุชุฑุงููุฉ.
    </p>
  </header>

  <!-- โ ADSENSE (TOP โ SAFE) -->
  <div class="mb-10 border rounded-lg py-4 text-center text-gray-400 text-sm">
    ๐ ุฅุนูุงู (Google AdSense)
  </div>

  <!-- INPUT -->
  <textarea
    id="topicInput"
    class="w-full border rounded-xl p-4 text-lg
           focus:outline-none focus:ring-2 focus:ring-purple-500"
    rows="4"
    placeholder="ุงูุชุจ ููุถูุน ุงูููุงู ุงูุฐู ุชุฑูุฏ ุฅูุดุงุกู..."
  ></textarea>

  <!-- GENERATE -->
  <button
    id="generateBtn"
    class="w-full bg-purple-600 text-white py-3 rounded-xl mt-4
           font-semibold hover:bg-purple-700 transition"
  >
    ุฅูุดุงุก ุงูููุงู ุงูุขู
  </button>

  <!-- LOADING -->
  <p id="loading" class="hidden mt-4 text-center text-lg">
    โณ ุฌุงุฑู ุฅูุดุงุก ุงูููุงู...
  </p>

  <!-- RESULT -->
  <div id="resultBox" class="hidden mt-8 bg-gray-100 p-6 rounded-xl">
    <h2 class="font-bold text-xl mb-4">๐ ุงูููุงู ุงููุงุชุฌ</h2>

    <div id="articleResult"
      class="text-gray-800 leading-8 whitespace-pre-wrap">
    </div>

    <button
      id="copyArticleBtn"
      class="mt-6 w-full bg-gray-900 text-white py-3 rounded-xl text-lg"
    >
      ๐ ูุณุฎ ุงูููุงู
    </button>

    <p id="copyMsg" class="hidden text-green-600 font-semibold mt-2 text-center">
      โ ุชู ูุณุฎ ุงูููุงู ุจูุฌุงุญ
    </p>

    <!-- โ ADSENSE (BOTTOM โ OPTIONAL) -->
    <div class="mt-10 border rounded-lg py-4 text-center text-gray-400 text-sm">
      ๐ ุฅุนูุงู (Google AdSense)
    </div>
  </div>

</section>

<script>
  const generateBtn = document.getElementById("generateBtn");
  const topicInput = document.getElementById("topicInput");
  const resultBox = document.getElementById("resultBox");
  const articleResult = document.getElementById("articleResult");
  const loading = document.getElementById("loading");

  generateBtn.onclick = async () => {
    if (!topicInput.value.trim()) {
      alert("ุงููุฑุฌู ุฅุฏุฎุงู ููุถูุน ููููุงู");
      return;
    }

    generateBtn.disabled = true;
    loading.classList.remove("hidden");

    const res = await fetch("/api/article", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic: topicInput.value })
    });

    const data = await res.json();

    loading.classList.add("hidden");
    generateBtn.disabled = false;

    if (data.article) {
      articleResult.textContent = data.article;
      resultBox.classList.remove("hidden");
    } else {
      alert("โ ููุน ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูููุงู");
    }
  };

  const copyBtn = document.getElementById("copyArticleBtn");
  const copyMsg = document.getElementById("copyMsg");

  copyBtn.onclick = async () => {
    const text = articleResult.innerText.trim();
    if (!text) return;

    await navigator.clipboard.writeText(text);
    copyMsg.classList.remove("hidden");
    setTimeout(() => copyMsg.classList.add("hidden"), 2000);
  };
</script>

</Layout>
