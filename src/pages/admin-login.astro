---
let error = "";

if (Astro.request.method === "POST") {
  const data = await Astro.request.formData();
  const username = data.get("username");
  const password = data.get("password");

  const apiUrl = new URL("/api/admin-login", Astro.request.url);

  const res = await fetch(apiUrl, {
    method: "POST",
    body: JSON.stringify({ username, password }),
    headers: { "Content-Type": "application/json" },
  });

  const result = await res.json();
  console.log("LOGIN RESULT:", result);

  if (result.ok) {
    return Astro.redirect("/admin");
  } else {
    error = "âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
  }
}
---

<html lang="ar" dir="rtl">
 <meta charset="UTF-8" />

  <body>
    <h1>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</h1>
    <form method="POST">
      <input name="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†" />
      <input name="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
      <button>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </form>

    {error && <p style="color:red;">{error}</p>}
  </body>
</html>
